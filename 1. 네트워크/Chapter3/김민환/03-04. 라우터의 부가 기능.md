# 03-04. 라우터의 부가 기능	

> - `성공과 실패를 결정하는 1%의 네트워크 원리`를 참고하였다.
> - **주소 변환**과 **패킷 필터링**



### 주소 변환

- 라우터의 부가 기능 중 하나인 주소 변환을 알아본다.
- **주소 변환이 왜 필요할까?**
  - 주소는 각각의 고유한 단말기를 구별하는 유일한 것이다.
  - 하지만 1990년 대에 접속자 수가 증가하면서 할당할 주소가 부족했다.
  - 이를 위해, 같은 주소를 독립된 서로 다른 네트워크에서 동시에 사용해도 문제가 되지않는다는 것을 이용하게되었다.
  - 하지만 사내 네트워크에서 규칙없이 주소를 할당하면 문제가 발생하기 때문에 사내용 주소를 **private address**라 하고 이전에 사용했던 고유한 주소는 **global address**로 부르기로 하였다.
    - private address는 `10.0.0.0 ~ 10.255.255.255`, `172.16.0.0 ~ 172.31.255.255`, `192.168.0.0 ~ 192.168.255.255`를 사용한다.
    - 이는 기존에 global address 중에서 사용하지 않았던 주소의 범위다.
  - 하지만 이렇게되면 다른 네트워크와 통신을 할 때 문제가 발생한다. => 같은 주소를 갖는 것이 여러 개일 수 있기 때문에 패킷을 정확히 보낼 수 없다.
  - 따라서 주소 변환이 필요하게 되었다.
- 주소 변환은 다른 네트워크와 통신을 할 때는 global address를 사용하게하고 사내 네트워크에서는 private address를 사용하도록 한다.



### 주소 변환의 기본 동작

- 주소변환의 구조는 패킷을 중계할 때 IP 헤더에 기재된 IP 주소와 포트 번호를 바꿔쓰는 것이다.
- 송신처의 IP 주소를 private address에서 global address로 변경한다.
  - 여기서 global address는 주소 변환 장치의 인터넷 측에 잇는 포트에 할당된 주소로 변경한다.
  - 동시에 포트 번호도 변경
- 이제 변경 전의 정보와 변경 후의 정보를 한 세트로 주소변환 장치 내부에 있는 대응표에 **등록**한다.
- 이제 주소를 변경했다면 패킷을 인터넷에 송출하고 서버에서는 회신 패킷이 돌아오게 된다.
- 주소 대응표를 활용하여 서버에서 회신 패킷을 보낼 때는 global address => private address로 서버에 패킷을 보낼 때는 private address => global address로 변경하게 된다.
- 연결 되는동안 패킷이 흐르다가 인터넷에 대한 접속이 끝나면 대응표에 등록한 것을 **삭제**한다.
- **포트 번호를 변경하는 이유**
  - 이전에는 주소만 바꿔썼지만 그렇게되면 private address와 global address가 1대1 대응이되어서 인터넷에 접속하는 수만큼의 global address가 필요하다.
  - 따라서 포트 번호를 바꿔쓰게 되는데 클라이언트 측의 포트 번호는 사용하지않는 것이 많기 때문에 무작위로 선택해서 사용할 수 있다.
  - 포트 번호도 바꿔쓰면서 이용효율을 높일 수 있다.



### 인터넷에서 사내 네트워크로 액세스할 때

- 사내 네트워크에서 인터넷으로 액세스할 때는 대응표를 사용한다.
- 하지만 인터넷에서 사내 네트워크로 액세스할 때는 대응표에 등록되어 있지않으면 할 수 없다.
- 사내에서 의도적으로 인터넷에 액세스하지 않는 이상 인터넷측에서 사내에 패킷을 보낼 수 없다.
  - 부정 침입 방지 효과



### 패킷 필터링

- 패킷 필터링은 부정 침입을 방지한다.
- 패킷을 중계할 때 MAC 헤더, IP 헤더, TCP 헤더에 기록되어 있는 내용을 조사하여 사저에 설정한 조건과 맞는다면 패킷을 중계하거나 폐기한다.