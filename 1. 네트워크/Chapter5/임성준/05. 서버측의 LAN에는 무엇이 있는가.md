## 05. 서버측의 LAN에는 무엇이 있는가?

### 방화벽과 캐시 서버의 탐험

[toc]

### 용어 정리

- **방화벽** : 집 안과 밖에서 침입자를 막아주는 현관문, 내외부 네트워크 상호 간 영향을 차단해 불법 침입과 정보 유출을 방지, 보통 모든 통신포트를 차단하고 일부 포트만을 허용하여 방어한다.
- **패킷 필터링** : 방화벽에서 정의한 엑세스 제어 규칙에 따라 패킷의 통과 여부를 결정한다.
- **부하 분산 장치** : 웹/캐시 서버의 처리 부하를 균등하게 분배하는 장치, 패킷 수신인 IP주소나 MAC주소를 다른 것으로 바꾸어 각 서버에 할당하여 동작한다. ( 라운드 로빈 방식 )
- **캐시서버** : 웹에서 사용자가 자주 찾는 정보만을 따로 모아두는 서버, 시간을 절약하기 위한 방법, 인터넷의 요구를 대행해주므로 프록시 서버릐 개념을 가지고 방화벽 서버역할도 수행한다.
- **프록시 서버** : 시스템에 방화벽이 존재하는 경우 외부와의 통신을 위해 만들어놓은 서버 (중계자 역할)



### 주요 내용 정리

#### 웹 서버의 설치 장소

기존에는 사내의 LAN에 서버를 설치하였지만 IP주소의 부족과 보안상의 이유로 데이터센터에 방화벽을 두는 방법으로 웹 서버를 설치하게 되었다.



#### 방화벽의 원리와 동작

방화벽에서는 특정 서버나 특정 애플리케이션의 패킷만을 통과시키기위해 패킷을 제한하는 설정이 필요하다.

가장 많이 보급화된 **패킷 필터링형 방화벽**은 어떻게 동작하는지 알아보자❕❕

- **패킷의 흐름을 검사**

  - 패킷의 시점은 알 수 없지만, 정상적인 패킷의 흐름의 종점은 웹서버가 되므로 수신처 IP주소가 웹 서버의 IP주소에 일치하면 통과시키는 조건
  - 인터넷에서 웹 서버로 가는 패킷은 통과하지만 웹 서버에서 인터넷으로 가는 패킷도 고려해야 하므로 시점이 웹 서버의 IP주소이면 통과시키는 조건

  

 - **애플리케이션 한정 조건**

   - 애플리케이션을 한정하기 위해서는 TCP/UDP 헤더에 기록되어 있는 포트 번호를 조건으로 추가

   

- **엑세스를 제한하기 위해 접속 방향 검사**

  > 웹 서버에서 인터넷으로 요청을 보내는 경우를 차단하기 위해서,,?

  - TCP 헤더에 있는 컨트롤 비트로 엑세스 방향을 검사
  - 최초 패킷이 웹 서버에서 인터넷으로 흘러가는 것을 차단해서 웹 서버가 기점인 엑세스를 제한

  

- **사내 LAN과 공개 서버용 LAN으로 조건 설정**



- **외부에서 사내 LAN으로 엑세스 제한**



##### 방화벽의 문제점

**방화벽은 시점과 종점만 조사하므로 패킷 중에 특수한 데이터가 포함되어도 통과시킨다.**

- 웹 서버 소프트웨어 버그 수정
- 패킷의 내용 조사



#### 복수 서버에 리퀘스트를 분배한 서버의 부하 분산

> 서버의 분산을 위해 단순히 여러 대의 웹 서버를 설치

- 라운드 로빈 방식으로 복수의 서버에 균등하게 엑세스 분산

  문제점

  - 웹 서버 중 하나가 고장나서 정지해도 IP주소를 회답
  - 복수의 페이지에서 대화를 할 경우 웹 서버가 변하면 대화가 끊기는 경우

- 부하 분산 장치를 이용해 부하 분산

  - 여러 페이지에 대화하는지 여부
  - 웹 서버의 부하 상태를 보고 판단해 분산



#### 캐시 서버를 이용한 서버의 부하분산

> 프록시라는 구조를 사용하여 데이터를 캐시에 저장하는 서버

- 웹 서버에서 받아 정당한 데이터를 읽어서 송신만 하면 되므로 웹 서버보다 빠르다.

- 캐시 서버의 동작
  - 사용자가 서버에 HTTP 리퀘스트 메시지 보냄
  
  - 캐시 서버가 수신
  
  - 리퀘스트 메시지 조사
  
  - 자신의 캐시에 저장되어 있는지 조사
  
  - 어느 웹 서버에 전송할지 리퀘스트 메시지의 디렉토리를 보고 판별
    1. 저장되어 있지 않은 경우
       - `Via` 헤더 필드를 부가해 웹 서버에 송신
         
         - 캐시서버를 거쳐갔다는 의미
         
         
    2. 저장되어 있는 경우
       - `If-Modified-Since` 헤더 필드를 추가해 웹 서버에 전송
         
         - 웹 서버에서 데이터가 변경되었는지 여부 조사를 위함
         
         
    
  - 웹 서버가 수신 후 응답을 캐시 서버에 송신
  
  - 캐시 서버가 클라이언트에게 송신
  
  - 응답 메시지를 저장 일시와 함께 캐시에 저장
  
  
  
- **포워드 프록시**

  - 클라이언트측에 캐시 서버를 두는 구조
  - 트래픽을 억제 가능
  - 브라우저에 대한 설정이 필요

- **리버스 프록시**

  - 서버측에 캐시 서버를 두는 구조
  - 보통의 리퀘스트 메시지로 전송 가능
  - 웹 서버의 부하를 줄임
  - 브라우저에 대한 설정 불필요

- **트랜스페어런트 프록시**

  - 포워드와 리버스 프록시의 장점을 모아둔 것

  - 패킷의 헤더에 있는 수신처 IP주소로 엑세스 대상 웹 서버를 확인 가능
  - 브라우저에 대한 설정 불필요
  - 캐시서버에 전송 대상 설정 불필요
  - 클라이언트나 서버에 서버를 두지 않기 때문에 브라우저에서 웹 서버로 리퀘스트 메시지가 흘러가는 길에 트랜스페어런트 프록시 설치



#### 콘텐츠 배포 서비스

>  인터넷에 다수의 캐시 서버를 설치하고, 웹 서버 운영자에게 대출하는 서비스

- 캐시 서버를 놓는 위치에 따른 장점들을 프로바이더와 계약하여 캐시 서버를 클라이언트측의 프로바이더에 두는 방법으로써 제공하는 서비스